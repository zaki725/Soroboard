# Swagger API ドキュメント

このドキュメントでは、Soroboard API の Swagger UI の使い方について説明します。

## 目次

- [Swagger UI とは](#swagger-ui-とは)
- [アクセス方法](#アクセス方法)
- [基本的な使い方](#基本的な使い方)
- [API エンドポイントのテスト](#api-エンドポイントのテスト)
- [よくある質問](#よくある質問)

## Swagger UI とは

Swagger UI は、REST API のドキュメントを視覚的に表示し、ブラウザから直接 API をテストできるツールです。このプロジェクトでは、NestJS の `@nestjs/swagger` パッケージを使用して Swagger UI を統合しています。

## アクセス方法

### 前提条件

バックエンドサーバーが起動している必要があります。

### URL

```
http://localhost:3001/api
```

### 起動方法

#### Docker を使用する場合

```bash
# バックエンドとデータベースを起動
docker-compose up -d backend db

# または、全サービスを起動
docker-compose up -d
```

起動後、ブラウザで `http://localhost:3001/api` にアクセスしてください。

#### ローカルで直接実行する場合

```bash
# バックエンドディレクトリに移動
cd backend

# 開発サーバーを起動
npm run start:dev
```

起動後、ブラウザで `http://localhost:3001/api` にアクセスしてください。

## 基本的な使い方

### 1. API エンドポイントの確認

Swagger UI を開くと、以下のような画面が表示されます：

- **左側**: API エンドポイントの一覧
  - エンドポイントはタグごとにグループ化されています
  - 例: `companies`、`users`、`recruit-years`

- **右側**: 選択したエンドポイントの詳細情報
  - リクエスト方法（GET、POST など）
  - パス
  - パラメータ
  - リクエストボディ
  - レスポンス形式

### 2. エンドポイントの詳細を確認する

1. 左側のメニューから確認したいエンドポイントをクリックします
2. エンドポイントを展開すると、詳細情報が表示されます
   - **Parameters**: クエリパラメータやパスパラメータ
   - **Request body**: リクエストボディのスキーマ
   - **Responses**: レスポンスのステータスコードとスキーマ

### 3. スキーマの確認

画面下部の「Schemas」セクションから、各データモデル（DTO）のスキーマを確認できます。

- 各プロパティの型
- 必須項目（必須項目には `*` マークが表示されます）
- 説明

## API エンドポイントのテスト

Swagger UI では、実際に API を呼び出してテストすることができます。

### ステップ 1: エンドポイントを選択

左側のメニューから、テストしたいエンドポイントを選択します。

### ステップ 2: "Try it out" ボタンをクリック

エンドポイントの詳細画面で、"Try it out" ボタンをクリックします。

### ステップ 3: パラメータやリクエストボディを入力

- **クエリパラメータ**: 例: `recruitYearId=2024`
- **パスパラメータ**: 例: `/users/{id}` の `id`
- **リクエストボディ**: JSON 形式で入力します

例（会社作成API）:

```json
{
  "name": "テスト株式会社",
  "phoneNumber": "03-1234-5678",
  "email": "test@example.com",
  "websiteUrl": "https://example.com",
  "recruitYearId": 2024
}
```

### ステップ 4: "Execute" ボタンをクリック

"Execute" ボタンをクリックすると、API リクエストが送信されます。

### ステップ 5: レスポンスを確認

レスポンスセクションに以下が表示されます：

- **Response Code**: HTTP ステータスコード（200、400、404 など）
- **Response Body**: レスポンスの内容（JSON 形式）
- **Response Headers**: レスポンスヘッダー

## よくある質問

### Q: Swagger UI にアクセスできない

**A:** 以下の点を確認してください：

1. バックエンドサーバーが起動しているか確認

   ```bash
   # Docker の場合
   docker-compose ps backend

   # ローカルの場合
   # ターミナルでエラーが出ていないか確認
   ```

2. ポート番号が正しいか確認（デフォルトは `3001`）

3. ブラウザのコンソールでエラーが出ていないか確認

### Q: API リクエストが失敗する

**A:** 以下の点を確認してください：

1. **必須パラメータが不足していないか**
   - 必須項目には `*` マークが表示されています
   - リクエストボディで必須項目を確認してください

2. **データ形式が正しいか**
   - JSON 形式が正しいか確認
   - 型が正しいか確認（文字列、数値など）

3. **データベースが起動しているか**

   ```bash
   docker-compose ps db
   ```

4. **エラーメッセージを確認**
   - レスポンスボディにエラーメッセージが含まれている場合があります

### Q: Swagger UI で日本語が表示されない

**A:** Swagger UI は日本語の API 説明文を表示しますが、UI 自体は英語で表示されます。これは正常な動作です。

### Q: 新しいエンドポイントが Swagger UI に表示されない

**A:** 以下の点を確認してください：

1. **サーバーを再起動**
   - コードを変更した後は、サーバーを再起動してください

   ```bash
   # Docker の場合
   docker-compose restart backend

   # ローカルの場合
   # Ctrl+C で停止後、再度 npm run start:dev
   ```

2. **Swagger デコレータを追加**
   - コントローラーに `@ApiTags()` デコレータを追加
   - エンドポイントに `@ApiOperation()` デコレータを追加
   - 詳細は `backend/README.md` を参照してください

### Q: CORS エラーが発生する

**A:** バックエンドサーバーで CORS が有効になっているか確認してください。`src/main.ts` で `app.enableCors()` が呼び出されている必要があります。

## 参考資料

- [NestJS Swagger ドキュメント](https://docs.nestjs.com/openapi/introduction)
- [Swagger UI 公式ドキュメント](https://swagger.io/tools/swagger-ui/)
- [OpenAPI 仕様](https://swagger.io/specification/)

## サポート

問題が解決しない場合は、プロジェクトのメンバーに相談してください。
